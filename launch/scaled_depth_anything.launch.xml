<launch>

  <arg name="name" default="quadrotor1" />

  <!-- <arg name="input/image" default="/$(var name)/tracking_front/color/image_raw" />
  <arg name="camera_info" default="/$(var name)/tracking_front/color/image_raw/camera_info" />
  <arg name="camera_frame" default="$(var name)/tracking_front_frame" /> -->

  <arg name="input/image" default="/$(var name)/RGBD/color/image_raw" />
  <arg name="camera_info" default="/$(var name)/RGBD/color/image_raw/camera_info" />
  <arg name="camera_frame" default="$(var name)/RGBD_frame" />

  <arg name="output/depth_image" default="disparity" />
  <arg name="param_path" default="$(find-pkg-share depth_anything)/config/depth_anything.param.yaml" />
  <!-- <arg name="onnx_path" default="$(find-pkg-share depth_anything)/models/depth_anything_vitb14.onnx" /> -->
  <!-- <arg name="onnx_path" default="$(find-pkg-share depth_anything)/models/depth_anything_v2_vitb.onnx" /> -->
  <arg name="onnx_path" default="$(find-pkg-share depth_anything)/models/depth_anything_v2_vits.onnx" />

  <arg name="cloud" default="/$(var name)/openvins/points_slam" />

  <arg name="true_depth" default="sparse_depth" />

  <node pkg="depth_anything" exec="depth_anything_node" name="depth_anything" namespace="$(var name)/depth_anthing" output="screen">
    <remap from="~/input/image" to="$(var input/image)"/>
    <remap from="~/output/depth_image" to="$(var output/depth_image)"/>
    <param from="$(var param_path)" />
    <param name="onnx_path" value="$(var onnx_path)"/>
  </node>

  <!-- <node pkg="depth_anything" exec="pointcloud_to_depthimage_node" name="pointcloud_to_depthimage" namespace="$(var name)/depth_anthing" output="screen">
    <remap from="cloud"               to="$(var cloud)"/>
    <remap from="camera_info"         to="$(var camera_info)"/>
    <remap from="depth_image"         to="$(var true_depth)"/>
    <param name="fixed_frame_id"      value="$(var name)/odom"/>
    <param name="cam_frame_id"        value="$(var camera_frame)"/>
    <param name="wait_for_transform"  value="0.3"/>
    <param name="syncQueueSize"       value="10"/>
    <param name="topicQueueSize"      value="3"/>
    <param name="approx"              value="true"/>
  </node> -->
  
  <node pkg="odom_synchronizer" exec="odom_synchronizer.py" name="odom_synchronizer_node" output="screen">
    <param name="base_frame"            value="$(var name)/base_link"/>
    <param name="odom_frame"            value="$(var name)/odom"/>
    <remap from="odom"                  to="/$(var name)/odometry/local"/>
    <remap from="image_raw"             to="$(var input/image)"/>
    <remap from="synced_odom"           to="/$(var name)/synced_odom"/>
  </node>

  <node pkg="depth_anything" exec="pointcloud_to_depthimage_node_v2" name="pointcloud_to_depthimage" namespace="$(var name)/depth_anthing" output="screen">
    <remap from="cloud"               to="$(var cloud)"/>
    <remap from="camera_info"         to="$(var camera_info)"/>
    <remap from="synced_odom"         to="/$(var name)/synced_odom"/>
    <remap from="depth_image"         to="$(var true_depth)"/>
    <param name="fixed_frame_id"      value="$(var name)/odom"/>
    <param name="cam_frame_id"        value="$(var camera_frame)"/>
  </node>

  <node pkg="ov_msckf" exec="run_subscribe_msckf" name="open_vins" output="screen" namespace="$(var name)/openvins">
    <param name="config_path"           value="$(find-pkg-share estimation_launch)/config/vio/estimator_config.yaml"/>
    <param name="imu_frame"             value="$(var name)/base_link"/>
    <param name="global_frame"          value="$(var name)/odom"/>
    <param name="verbosity"             value="WARNING"/>
    <remap from="imu"                   to="/$(var name)/imu/data"/>
    <remap from="cam0/image_raw"        to="/$(var name)/tracking_front/color/image_raw"/>
    <remap from="cam1/image_raw"        to="/$(var name)/tracking_down/color/image_raw"/>
    <remap from="odomimu"               to="/$(var name)/odometry/local"/>
  </node> 

  <node pkg="depth_anything" exec="depth_align_node" name="depth_anything" namespace="$(var name)/depth_anthing" output="screen">
    <remap from="sparse_topic"          to="$(var true_depth)"/>
    <remap from="dense_topic"           to="$(var output/depth_image)"/>
    <remap from="depth_image"           to="depth_image"/>
    <remap from="depth/pointcloud"      to="pointcloud_registered"/>
    <param name="sync_queue_size"       value="100"/>
    <param name="max_depth"             value="40.0"/>
    <param name="pub_cloud"             value="true"/>
    <param name="odom_frame_id"         value="$(var name)/odom"/>
    <param name="duration"              value="0.5"/>
    <param name="decimation"           value="1"/>
    <param name="voxel_size"           value="0.1"/>
  </node>

</launch>
